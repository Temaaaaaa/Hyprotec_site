@use '../helpers' as *;

/* ————————————————————————————————
   Intro overlay — fast & pretty (with logo image)
   ———————————————————————————————— */

.intro {
  /* Настройки */
  --intro-ease: cubic-bezier(.22,1,.36,1);
  --intro-fade-dur: .42s;
  --intro-leave-dur: .46s;
  --intro-accent: var(--color-accent, #e53935);
  --intro-fg: var(--color-white, #fff);
  --intro-bg-1: #171a20;
  --intro-bg-2: #1b2028;

  position: fixed;
  inset: 0;
  z-index: 9999;
  display: grid;
  place-items: center;
  pointer-events: none;
  background: none;
  isolation: isolate;
  contain: layout paint;
  transform: translateZ(0);
  will-change: opacity, transform;

  /* быстрое удаление ноды (на случай, если понадобится принудительно) */
  &--hidden { display: none !important; }

  /* Фон */
  &__bg {
    position: absolute;
    inset: 0;
    z-index: -1;
    background:
            radial-gradient(60% 40% at 50% 20%, rgba(255,255,255,.08), transparent 65%),
            linear-gradient(180deg, var(--intro-bg-1), var(--intro-bg-2) 55%, var(--intro-bg-1));

    &::before {
      content: "";
      position: absolute;
      inset: -10%;
      pointer-events: none;
      background: radial-gradient(70% 60% at 50% 65%, color-mix(in srgb, var(--intro-accent), transparent 82%) 0%, transparent 70%);
      opacity: .7;
      transform: translateZ(0) scale(1);
      will-change: transform, opacity;
      animation: intro-glow 3.2s ease-in-out infinite alternate;
    }

    @media (hover:hover) and (pointer:fine) {
      &::after {
        content: "";
        position: absolute;
        inset: -28%;
        opacity: .045;
        pointer-events: none;
        background:
                repeating-linear-gradient(0deg,  rgba(255,255,255,.06) 0 1px, transparent 1px 2px),
                repeating-linear-gradient(90deg, rgba(255,255,255,.03) 0 1px, transparent 1px 2px);
      }
    }
  }

  &__inner {
    width: min(100%, rem(1100));
    display: grid;
    justify-items: center;
    row-gap: rem(20);
    text-align: center;
    color: var(--intro-fg);
    content-visibility: auto;
  }

  &__brand {
    display: grid;
    row-gap: rem(10);
  }

  /* Контейнер логотипа */
  &__logo {
    display: inline-grid;
    place-items: center;
    will-change: transform, opacity;

    /* если где-то остались посимвольные части — прячем, чтобы не ломали раскладку */
    .intro__logo-part { display: none !important; }
  }

  /* Картинка логотипа */
  &__logo-img {
    inline-size:  clamp(rem(220), 28vw, rem(520));;
    block-size: auto;
    opacity: 0;
    transform: translateY(6px) scale(.985);
    will-change: opacity, transform;
    animation: intro-logo-reveal .7s var(--intro-ease) .2s both;
  }

  &__tagline {
    @include fluid-text(20, 14);
    color: color-mix(in srgb, var(--intro-fg), transparent 35%);
    letter-spacing: .08em;
    text-transform: lowercase;
    transform: translateY(6px);
    opacity: 0;
    animation: intro-fade-up var(--intro-fade-dur) .32s ease-out forwards;
    will-change: transform, opacity;
  }

  &__progress {
    width: min(100%, rem(480));
    height: rem(3);
    background: color-mix(in srgb, var(--intro-fg), transparent 85%);
    border-radius: 999px;
    overflow: hidden;
    margin-top: rem(10);
    transform: translateY(4px);
    opacity: 0;
    animation: intro-fade-up calc(var(--intro-fade-dur) - .06s) .44s ease-out forwards;
    will-change: opacity, transform;
  }

  &__bar {
    display: block;
    width: 0%;
    height: 100%;
    background: var(--intro-accent);
    animation: intro-bar var(--intro-bar-dur, 1.6s) var(--intro-bar-delay, .45s) ease-out forwards;
    will-change: width;
  }

  /* Мягкий уход (JS добавляет .is-leaving) */
  &.is-leaving { animation: intro-leave-lite var(--intro-leave-dur) var(--intro-ease) forwards; }
}

/* Пока интро активно — стопаем «печатную машинку» */
html.is-intro-active .hero .hero__subtitle--type {
  animation: none !important;
  border-right: 0 !important;
}

/* ——— Keyframes ——— */
@keyframes intro-glow {
  0%   { opacity: .55; transform: translateZ(0) scale(.985) translateY(0); }
  100% { opacity: .85; transform: translateZ(0) scale(1.035) translateY(-1%); }
}
@keyframes intro-logo-reveal {
  to { opacity: 1; transform: translateY(0) scale(1); }
}
@keyframes intro-fade-up {
  from { transform: translateY(6px); opacity: 0; }
  to   { transform: translateY(0);   opacity: 1; }
}
@keyframes intro-bar { from { width: 0%; } to { width: 100%; } }
@keyframes intro-leave-lite { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(.985); } }

/* Reduce Motion */
@media (prefers-reduced-motion: reduce) {
  .intro, .intro * { animation: none !important; transition: none !important; }
  .intro { background: var(--color-dark, #111); }
}
